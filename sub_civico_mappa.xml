<plominodatabase id="iol_praticaweb">
  <design>
    <element id="sub_civico_mappa" title="Mappa  datagrid civico" type="PlominoForm">
      <id type="Products.Archetypes.Field.StringField">sub_civico_mappa</id>
      <onCreateDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></onCreateDocument>
      <onOpenDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></onOpenDocument>
      <beforeSaveDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></beforeSaveDocument>
      <onSaveDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></onSaveDocument>
      <onDeleteDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></onDeleteDocument>
      <onSearch type="Products.Archetypes.Field.TextField"><![CDATA[]]></onSearch>
      <beforeCreateDocument type="Products.Archetypes.Field.TextField"><![CDATA[]]></beforeCreateDocument>
      <FormLayout type="Products.Archetypes.Field.TextField"><![CDATA[
<div class="alert alert-info">
<h3>Localizzazione del civico da inserire</h3>
<div class="row-fluid">
<div class="span6">
<span class="plominoLabelClass">civico_via</span><span class="plominoFieldClass">civico_via</span>
</div>
<div class="span3">
<span class="plominoLabelClass">civico_civico</span><span class="plominoFieldClass">civico_civico</span>
</div>
<div class="span3">
<span class="plominoLabelClass">civico_altro</span><span class="plominoFieldClass">civico_altro</span>
</div>
</div>
</div>
<div id="layerbox">
<span class="plominoLabelClass">livelli</span><span class="plominoFieldClass">livelli</span>
</div>
<div class="row-fluid"><div class="span4">
<span class="plominoLabelClass">elemento_tipo</span><span class="plominoFieldClass">elemento_tipo</span>
</div></div>
<p><span class="plominoFieldClass">geometry</span></p>
<p><span class="plominoLabelClass">elenco_civici</span><span class="plominoFieldClass">elenco_civici</span></p>
]]></FormLayout>
      <FormMethod type="Products.Archetypes.Field.TextField"><![CDATA[Auto]]></FormMethod>
      <DocumentTitle type="Products.Archetypes.Field.TextField"><![CDATA[]]></DocumentTitle>
      <DynamicDocumentTitle type="Products.Archetypes.Field.BooleanField">False</DynamicDocumentTitle>
      <StoreDynamicDocumentTitle type="Products.Archetypes.Field.BooleanField">False</StoreDynamicDocumentTitle>
      <DocumentId type="Products.Archetypes.Field.TextField"><![CDATA[]]></DocumentId>
      <ActionBarPosition type="Products.Archetypes.Field.StringField">BOTH</ActionBarPosition>
      <HideDefaultActions type="Products.Archetypes.Field.BooleanField">False</HideDefaultActions>
      <HideInMenu type="Products.Archetypes.Field.BooleanField">True</HideInMenu>
      <isSearchForm type="Products.Archetypes.Field.BooleanField">False</isSearchForm>
      <isPage type="Products.Archetypes.Field.BooleanField">False</isPage>
      <SearchView type="Products.Archetypes.Field.StringField"/>
      <SearchFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></SearchFormula>
      <Position type="Products.Archetypes.Field.IntegerField"/>
      <ResourcesJS type="Products.Archetypes.Field.TextField"><![CDATA[https://maps.google.com/maps/api/js?key=AIzaSyDCm6eNZUkOpttT5TvlycUJFJq3K3ir5ys&libraries=places,drawing
++resource++iol.document/js/proj4js.js
++resource++iol.document/js/proj4js-defs.js
++resource++iol.document/js/iolGoogleMap.js
++resource++iol.praticaweb/js/controller_combo_civici.js
++resource++iol.praticaweb/js/controller_datagrid_comune.js
++resource++iol.document/js/iolHistory.js]]></ResourcesJS>
      <ResourcesCSS type="Products.Archetypes.Field.TextField"><![CDATA[++resource++iol.document/css/bootstrap.css
++resource++iol.praticaweb/css/iol-sue.css
resources/iol-custom.css]]></ResourcesCSS>
      <excludeFromNav type="Products.Archetypes.Field.BooleanField">False</excludeFromNav>
      <elements>
        <element id="livelli" title="Livelli" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">livelli</id>
          <FieldType type="Products.Archetypes.Field.StringField">SELECTION</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[return ['accessi']]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField">SELECTIONFieldEdit</FieldReadTemplate>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA[return '''
data-map-layers = 
'[{"name":"OSM","type":"TMS","maxZoom":18,"minZoom":8,"opacity":0.8,"url":"http://tile.openstreetmap.org","alt":"OpenStreetMap"},
{"name":"accessi","type":"WMS","maxZoom":18,"minZoom":8,"opacity":1,"url":"http://88.58.112.251/gisclient3/services/ows.php?MAP=cartografia_completa&TRANSPARENT=TRUE&LAYERS=grp_accessi","alt":"Accessi"},{"name":"viabilita","type":"WMS","maxZoom":18,"minZoom":8,"opacity":0.6,"url":"http://88.58.112.251/gisclient3/services/ows.php?MAP=cartografia_completa&TRANSPARENT=TRUE&LAYERS=grp_viabilita.lay_viabilita","alt":"Viabilità"}]'
data-map-types = "OSM,roadmap,terrain,satellite,hybrid"
data-base-type = "roadmap"
''']]></HTMLAttributesFormula>
          <params>
<param>
<value><struct>
<member>
<name>selectionlistformula</name>
<value><string>return ['Accessi|accessi','Viabilità|viabilita']</string></value>
</member>
<member>
<name>dynamictableparam</name>
<value><string>'bPaginate': true,
'bLengthChange': true,
'bFilter': true,
'bSort': true,
'bInfo': true,
'bAutoWidth': false</string></value>
</member>
<member>
<name>widget</name>
<value><string>CHECKBOX</string></value>
</member>
</struct></value>
</param>
</params>
        </element>
        <element id="geometry" title="Mappa" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">geometry</id>
          <FieldType type="Products.Archetypes.Field.StringField">TEXT</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField">TEXTFieldEdit</FieldReadTemplate>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA[return '''data-edit-mode = %s
data-base-url = %s
data-plugin='iolGoogleMap' 
data-plugin-options='{"scaleControl": true,"minZoom": 8, "zoom":12, "center": [40.571,8.320], "scrollwheel": false,"mapTypeId":"","coordsrid":3003}'
data-map-layers = 'livelli'
data-drawing-target = 'elenco_civici'
data-open-dialog = 1
data-drawing-tools='elemento_tipo'
data-drawing-options='{
"empty":{"drawingControl":false,"drawingMode":null,"title":""
},
"punto":{"drawingControl":true,"drawingMode":"marker","title":"Elemento puntuale",
    "drawingControlOptions":{"drawingModes":["marker"]},
    "markerOptions":{"icon":"resources/icons/posizione_indirizzo.png","title":"Elemento puntuale","zIndex":1000001}
},
"linea":{"drawingControl":true,"drawingMode":"polyline","title":"Elemento lineare",
   "drawingControlOptions":{"drawingModes":["polyline"]},
   "polylineOptions":{"strokeColor":"#00FF00","strokeOpacity": 1.0,"strokeWeight": 2}
},
"area":{"drawingControl":true,"drawingMode":"polygon","title":"Elemento areale",
   "drawingControlOptions":{"drawingModes":["polygon"]},
   "polygonOptions":{"strokeColor":"#00FFFF","strokeOpacity": 1.0,"strokeWeight": 2}
}}'
data-geocoding='find_location'
''' % (1 if not context.isDocument() or context.isEditMode() else 0, context.getParentDatabase().absolute_url())]]></HTMLAttributesFormula>
          <params>
<param>
<value><struct>
<member>
<name>widget</name>
<value><string>TEXT</string></value>
</member>
</struct></value>
</param>
</params>
        </element>
        <element id="elemento_tipo" title="Inserisci civico in mappa" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">elemento_tipo</id>
          <FieldType type="Products.Archetypes.Field.StringField">SELECTION</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField">SELECTIONFieldValue</FieldReadTemplate>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></HTMLAttributesFormula>
          <params>
<param>
<value><struct>
<member>
<name>selectionlistformula</name>
<value><string>['|empty','Elemento puntuale|punto']</string></value>
</member>
<member>
<name>dynamictableparam</name>
<value><string>'bPaginate': true,
'bLengthChange': true,
'bFilter': true,
'bSort': true,
'bInfo': true,
'bAutoWidth': false</string></value>
</member>
<member>
<name>widget</name>
<value><string>SELECT</string></value>
</member>
</struct></value>
</param>
</params>
        </element>
        <element id="civico_via" title="Via" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">civico_via</id>
          <FieldType type="Products.Archetypes.Field.StringField">SELECTION</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField">SELECTIONFieldRead</FieldReadTemplate>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField">SELECTIONFieldEdit</FieldEditTemplate>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA['data-tooltip="Stradario del comune"']]></HTMLAttributesFormula>
          <params>
<param>
<value><struct>
<member>
<name>selectionlistformula</name>
<value><string>context.getParentDatabase().resources.customscripts.getElencoVie(context)</string></value>
</member>
<member>
<name>dynamictableparam</name>
<value><string>'bPaginate': true,
'bLengthChange': true,
'bFilter': true,
'bSort': true,
'bInfo': true,
'bAutoWidth': false</string></value>
</member>
</struct></value>
</param>
</params>
        </element>
        <element id="civico_civico" title="Civico precedente" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">civico_civico</id>
          <FieldType type="Products.Archetypes.Field.StringField">TEXT</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField"/>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA["data-zoomto=1"]]></HTMLAttributesFormula>
        </element>
        <element id="civico_altro" title="Civico successivo" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">civico_altro</id>
          <FieldType type="Products.Archetypes.Field.StringField">TEXT</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField"/>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></HTMLAttributesFormula>
        </element>
        <element id="elenco_civici" title="Elenco civici assegnati" type="PlominoField">
          <id type="Products.Archetypes.Field.StringField">elenco_civici</id>
          <FieldType type="Products.Archetypes.Field.StringField">DATAGRID</FieldType>
          <FieldMode type="Products.Archetypes.Field.StringField">EDITABLE</FieldMode>
          <Formula type="Products.Archetypes.Field.TextField"><![CDATA[]]></Formula>
          <FieldReadTemplate type="Products.Archetypes.Field.StringField"/>
          <FieldEditTemplate type="Products.Archetypes.Field.StringField"/>
          <Mandatory type="Products.Archetypes.Field.BooleanField">False</Mandatory>
          <ValidationFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></ValidationFormula>
          <ToBeIndexed type="Products.Archetypes.Field.BooleanField">False</ToBeIndexed>
          <IndexType type="Products.Archetypes.Field.StringField">DEFAULT</IndexType>
          <HTMLAttributesFormula type="Products.Archetypes.Field.TextField"><![CDATA[]]></HTMLAttributesFormula>
          <params>
<param>
<value><struct>
<member>
<name>associated_form</name>
<value><string>dlg_assegnazione_civici</string></value>
</member>
<member>
<name>field_mapping</name>
<value><string>numero_civico,via,accesso,piano,destinazione_locale,foglio,mappale,subalterno,lat,lng,geom</string></value>
</member>
<member>
<name>jssettings</name>
<value><string>"aoColumns": [
    { "sTitle": "N. civico assegnato"},
    { "sTitle": "Via"},
    { "sTitle": "Accesso"},
    { "sTitle": "Piano"},
    { "sTitle": "Destinazione principale dei locali" },
    { "sTitle": "Foglio"},
    { "sTitle": "Particella"},
    { "sTitle": "Subalterno"},
    { "sTitle": "Lat"},
    { "sTitle": "Lon"},
    { "sTitle": "Geom"} 
],
"bPaginate": false,
"bLengthChange": false,
"bFilter": false,
"bSort": false,
"bInfo": false,
"bAutoWidth": false,
"plominoDialogOptions": {
        "width": 800,
        "height": 600
    },
"latIndex":8,
"lngIndex":9,
"geomIndex":10

    
    
</string></value>
</member>
</struct></value>
</param>
</params>
        </element>
      </elements>
    </element>
  </design>
</plominodatabase>
